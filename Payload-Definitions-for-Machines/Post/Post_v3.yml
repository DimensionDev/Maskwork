$schema: http://json-schema.org/draft-07/schema#
description: urn:Maskbook:Post:3
title: urn:Maskbook:Post:3
properties:
    _urn:
        type: string
        description: urn:Maskbook:Post:3:${this.id}
        pattern: urn:Maskbook:Post:3:[0-9A-F]{64}
    _time:
        type: string
        description: ISO 8601 with UTC string (1970-01-01T00:00:00.000Z)
    _updatedAt:
        type: string
        description: ISO 8601 with UTC string (1970-01-01T00:00:00.000Z)
    id:
        type: string
        description: 2 random UUIDv4 strings, uppercase without hyphens
        pattern: [0-9A-F]{64}
    postKey:
        type: string
        realType: blob>base64
        bitLength: 128
        description: 128-bit entropy
        omit: true
        alias: 'a1'
    postIv:
        type: string
        realType: blob>base64
        bitLength: 512
        description: Post IV, 512-bit PRNG (without trailing padding characters)
        alias: 'a2'
    postLocator:
        type: string
        class: PostLocator:2
        description: Serialized PostLocator (v2)
        alias: 'a3'
    epheKeys:
        type: object
        class: EcdhEphemeralKeysDict:1
        description: EcdhEphemeralKeysDict (v1) object
        alias: 'a4'
    recipients:
        type: array
        alias: 'a5'
        allOf:
            type: string
            class: ProfileGroupIdentifier:2
            description: Serialized ProfileGroupIdentifier (v2)
    persona:
        type: string
        alias: 'a6'
        description: Serialized PersonaLocator (v2)
    profile:
        type: string
        description: Serialized ProfileLocator (v2)
    hint:
        type: string
        realType: blob>base64
        bitLength: 128
        description: AES.encrypt(this.postKey, persona.localKey).toString(Base64)
    ciphertext:
        type: string
        realType: blob>base64
        description: Ciphertext, encoded with Base64
    opportunistKeys:
        type: object
        description: X
        properties:
            bits:
                type: number
                description: How many last bits of respective public keys are used to divide recipient-specific ECDH payloads into groups
                alias: 'a1'
            data:
                type: array
                description: Groups
                alias: 'a2'
                allOf:
                    type: array
                    allOf:
                        type: string
                        realType: blob>base64
                        description: Recipeint-specific ECDH payload of this.postKey
                length: Math.pow(2, this.opportunistKeys.bits)
    pluginDataPub:
        type: object
        description: Each key must be a PluginIdentifier (v1)
    pluginDataSecRaw:
        type: object
        description: Each key must be a PluginIdentifier (v1)
        omit: true
    pluginDataSec:
        type: string
        realType:
            - object
            - bson
            - aes
            - base64
        example: data:object/bson/aes/base64;D9n+q20EIPEKGG0KOfNf5MaOBgT4tAuG0rFNhZ2285Crl58LdvsPWMML7kPk58EPAbU7eujSnFvLotP7HRqcgAT0E3nwbq614ezW7TpaoQFnrhuVsOYAm5aXzvcnARc2YE5F5lYlKH826W32gqXIT4Ftotaktpq3qtXpf1H2D6Pw
        description: AES.encrypt(BSON.encode(Obj), postKey).toString(Base64)
