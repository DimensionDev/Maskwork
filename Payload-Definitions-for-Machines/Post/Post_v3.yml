$schema: http://json-schema.org/draft-07/schema#
description: urn:Maskbook:Post:3
title: urn:Maskbook:Post:3
properties:
    _urn:
        type: string
        description: urn:Maskbook:Post:3:${this.id}:${this._time}
    _time:
        type: string
        description: ISO 8601 with UTC string (1970-01-01T00:00:00.000Z)
    _updatedAt:
        type: string
        description: ISO 8601 with UTC string (1970-01-01T00:00:00.000Z)
    id:
        type: string
        realType: blob>hex
        bitLength: 128
        description: Random UUIDv4 string, uppercase without hyphens
        pattern: [0-9A-F]{32}
    postKey:
        alias: 'a1'
        type: string
        realType: blob>base64
        bitLength: 128
        description: 128-bit entropy
        omit: true
    postIv:
        alias: 'a2'
        type: string
        realType: blob>base64
        bitLength: 512
        description: Post IV, 512-bit PRNG (without trailing padding characters)
    postLocator:
        alias: 'a3'
        type: string
        class: PostLocator:2
        description: Serialized PostLocator (v2)
    epheKeys:
        alias: 'a4'
        type: object
        class: EcdhEphemeralKeysDict:1
        description: EcdhEphemeralKeysDict (v1) object
    recipients:
        alias: 'a5'
        type: array
        allOf:
            type: string
            class: ProfileGroupIdentifier:2
            description: Serialized ProfileGroupIdentifier (v2)
    persona:
        alias: 'a6'
        type: string
        class: PersonaLocator:2
        description: Serialized PersonaLocator (v2)
    profile:
        alias: 'a7'
        type: string
        class: ProfileLocator:2
        description: Serialized ProfileLocator (v2)
    hint:
        alias: 'a8'
        type: string
        realType: blob>base64
        bitLength: 128
        description: AES.encrypt(this.postKey, this.persona.localKey).toString(Base64)
    ciphertext:
        alias: 'a9'
        type: string
        realType: blob>base64
        description: Ciphertext encoded
    opportunistKeys:
        alias: 'a10'
        type: object
        description: X
        properties:
            bits:
                type: number
                description: How many last bits of respective public keys are used to divide recipient-specific ECDH payloads into groups
                alias: 'a1'
            data:
                type: array
                description: Groups
                alias: 'a2'
                allOf:
                    type: array
                    allOf:
                        type: string
                        realType: blob>base64
                        description: Recipeint-specific ECDH payload of this.postKey
                length: Math.pow(2, this.opportunistKeys.bits)
    pluginDataPub:
        alias: 'a11'
        type: object
        description: Each key must be a PluginIdentifier (v1)
    pluginDataSecRaw:
        type: object
        description: Each key must be a PluginIdentifier (v1)
        omit: true
    pluginDataSec:
        alias: 'a12'
        type: string
        realType:
            - object
            - bson
            - aes
            - base64
        example: D9n+q20EIPEKGG0KOfNf5MaOBgT4tAuG0rFNhZ2285Crl58LdvsPWMML7kPk58EPAbU7eujSnFvLotP7HRqcgAT0E3nwbq614ezW7TpaoQFnrhuVsOYAm5aXzvcnARc2YE5F5lYlKH826W32gqXIT4Ftotaktpq3qtXpf1H2D6Pw
        description: AES.encrypt(BSON.encode(this.pluginDataSecRaw), this.postKey).toString(Base64)
